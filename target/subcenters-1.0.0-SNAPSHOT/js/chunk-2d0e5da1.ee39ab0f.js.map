{"version":3,"sources":["webpack:///./src/views/query-analysis/SpeedCurveReport.vue?0f7c","webpack:///src/views/query-analysis/SpeedCurveReport.vue","webpack:///./src/views/query-analysis/SpeedCurveReport.vue?2c0c","webpack:///./src/views/query-analysis/SpeedCurveReport.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","query","scopedSlots","_u","key","fn","model","value","callback","$$v","$set","expression","iconClassName","handleVehicleQuerySearch","loginType","_l","select","item","label","_e","on","handleQueryClick","_v","handleExportClick","proxy","staticClass","table","data","display","staticRenderFns","name","startTime","endTime","limit","vehicle","vehicleGroupId","inputVehicle","loading","option","vehicleGroup","chart","el","mounted","Date","getVehicleGroup","getVehicle","$nextTick","methods","baseURL","params","userId","setChart","xdata","push","DB_TIME","ydata","SPEED","clear","setOption","title","text","tooltip","trigger","xAxis","type","yAxis","series","length","cb","VEHICLE_NO","findSpeedCurve","VEHICLE_NUM","STATE","DIRECTION","PX_PY","PX","$confirm","confirmButtonText","cancelButtonText","cancelButtonClass","closeOnClickModal","center","window","open","component"],"mappings":"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","file":"js/chunk-2d0e5da1.ee39ab0f.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('t-query-panel',{attrs:{\"model\":_vm.query,\"footer\":\"300\"},scopedSlots:_vm._u([{key:\"querybar\",fn:function(){return [_c('el-form-item',[_c('el-date-picker',{attrs:{\"type\":\"datetime\",\"placeholder\":\"开始时间\"},model:{value:(_vm.query.startTime),callback:function ($$v) {_vm.$set(_vm.query, \"startTime\", $$v)},expression:\"query.startTime\"}})],1),_c('el-form-item',[_c('el-date-picker',{attrs:{\"type\":\"datetime\",\"placeholder\":\"结束时间\"},model:{value:(_vm.query.endTime),callback:function ($$v) {_vm.$set(_vm.query, \"endTime\", $$v)},expression:\"query.endTime\"}})],1),_c('el-form-item',[_c('el-input',{attrs:{\"prefix-icon\":_vm.iconClassName('icon-speed-limit'),\"placeholder\":\"限速值\"},model:{value:(_vm.query.limit),callback:function ($$v) {_vm.$set(_vm.query, \"limit\", $$v)},expression:\"query.limit\"}})],1),_c('el-form-item',[_c('el-autocomplete',{attrs:{\"prefix-icon\":_vm.iconClassName('icon-car'),\"fetch-suggestions\":_vm.handleVehicleQuerySearch,\"trigger-on-focus\":false,\"placeholder\":\"车牌号码\"},model:{value:(_vm.query.vehicle),callback:function ($$v) {_vm.$set(_vm.query, \"vehicle\", $$v)},expression:\"query.vehicle\"}})],1),_c('el-form-item',[(_vm.loginType==='1')?_c('el-select',{attrs:{\"filterable\":\"\",\"clearable\":\"\",\"placeholder\":\"请选择车辆组\"},model:{value:(_vm.query.vehicleGroupId),callback:function ($$v) {_vm.$set(_vm.query, \"vehicleGroupId\", $$v)},expression:\"query.vehicleGroupId\"}},_vm._l((_vm.select.vehicleGroup),function(item){return _c('el-option',{key:item.value,attrs:{\"label\":item.label,\"value\":item.value}})}),1):_vm._e()],1),_c('el-form-item',[_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.handleQueryClick}},[_vm._v(\"查询\")]),_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.handleExportClick}},[_vm._v(\"导出\")])],1)]},proxy:true},{key:\"footer\",fn:function(){return [_c('div',{staticClass:\"tw-chart\",attrs:{\"id\":\"e-chart\"}})]},proxy:true}])},[_c('t-table-page',{attrs:{\"data\":_vm.table.data,\"loading\":_vm.table.display}},[_c('el-table-column',{attrs:{\"type\":\"index\",\"label\":\"序号\",\"align\":\"center\",\"width\":\"50\",\"resizable\":false}}),_c('el-table-column',{attrs:{\"prop\":\"VEHICLE_NUM\",\"label\":\"车牌号码\",\"align\":\"center\",\"width\":\"140\"}}),_c('el-table-column',{attrs:{\"prop\":\"STATE\",\"label\":\"状态\",\"align\":\"center\",\"width\":\"120\"}}),_c('el-table-column',{attrs:{\"prop\":\"SPEED\",\"label\":\"速度\",\"align\":\"center\",\"width\":\"120\"}}),_c('el-table-column',{attrs:{\"prop\":\"DIRECTION\",\"label\":\"方向\",\"align\":\"center\",\"width\":\"120\"}}),_c('el-table-column',{attrs:{\"prop\":\"PX_PY\",\"label\":\"经纬度\",\"align\":\"center\",\"min-width\":\"180\",\"resizable\":false}})],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<!-- 速度曲线报表 -->\n<template>\n  <t-query-panel :model=\"query\" footer=\"300\">\n    <template v-slot:querybar>\n      <el-form-item>\n        <el-date-picker v-model=\"query.startTime\" type=\"datetime\" placeholder=\"开始时间\"></el-date-picker>\n      </el-form-item>\n      <el-form-item>\n        <el-date-picker v-model=\"query.endTime\" type=\"datetime\" placeholder=\"结束时间\"></el-date-picker>\n      </el-form-item>\n      <el-form-item>\n        <el-input\n          v-model=\"query.limit\"\n          :prefix-icon=\"iconClassName('icon-speed-limit')\"\n          placeholder=\"限速值\"\n        ></el-input>\n      </el-form-item>\n      <el-form-item>\n        <el-autocomplete\n          v-model=\"query.vehicle\"\n          :prefix-icon=\"iconClassName('icon-car')\"\n          :fetch-suggestions=\"handleVehicleQuerySearch\"\n          :trigger-on-focus=\"false\"\n          placeholder=\"车牌号码\"\n        ></el-autocomplete>\n      </el-form-item>\n      <el-form-item>\n        <el-select v-model=\"query.vehicleGroupId\" filterable clearable  placeholder=\"请选择车辆组\" v-if=\"loginType==='1'\">\n          <el-option\n            v-for=\"item in select.vehicleGroup\"\n            :key=\"item.value\"\n            :label=\"item.label\"\n            :value=\"item.value\">\n          </el-option>\n        </el-select>\n      </el-form-item>\n      <el-form-item>\n        <el-button type=\"primary\" @click=\"handleQueryClick\">查询</el-button>\n        <el-button type=\"primary\" @click=\"handleExportClick\">导出</el-button>\n      </el-form-item>\n    </template>\n    <t-table-page :data=\"table.data\" :loading=\"table.display\">\n      <el-table-column type=\"index\" label=\"序号\" align=\"center\" width=\"50\" :resizable=\"false\"></el-table-column>\n      <el-table-column prop=\"VEHICLE_NUM\" label=\"车牌号码\" align=\"center\" width=\"140\"></el-table-column>\n      <el-table-column prop=\"STATE\" label=\"状态\" align=\"center\" width=\"120\"></el-table-column>\n      <el-table-column prop=\"SPEED\" label=\"速度\" align=\"center\" width=\"120\"></el-table-column>\n      <el-table-column prop=\"DIRECTION\" label=\"方向\" align=\"center\" width=\"120\"></el-table-column>\n      <el-table-column prop=\"PX_PY\" label=\"经纬度\" align=\"center\" min-width=\"180\" :resizable=\"false\"></el-table-column>\n    </t-table-page>\n    <template v-slot:footer>\n      <div id=\"e-chart\" class=\"tw-chart\"></div>\n    </template>\n  </t-query-panel>\n</template>\n\n<script>\nimport moment from 'moment'\nimport echarts from 'echarts'\nimport { iconClassName ,baseURL} from 'util'\nimport axios from 'axios'\nimport _ from 'underscore'\nexport default {\n  name: 'SpeedCurveReport',\n  data() {\n    return {\n      loginType:'',\n      query: {\n        startTime: '',\n        endTime: '',\n        limit: 0,\n        vehicle: '',\n        vehicleGroupId: '',\n      },\n      inputVehicle: {\n        loading: false,\n        option: []\n      },\n      table: {\n        display: false,\n        data: []\n      },\n      select:{\n        vehicle:[],\n        vehicleGroup:[],\n      },\n      chart: {\n        el: null\n      }\n    }\n  },\n  mounted() {\n    this.query.startTime = new Date(moment().add('day', -1));\n    this.query.endTime = new Date();\n    // this.findSpeedCurve();\n    this.loginType=this.$cookies.get('loginType');\n    this.getVehicleGroup();\n    this.getVehicle();\n    this.$nextTick(() => {\n      this.chart.el = echarts.init(document.getElementById('e-chart'))\n    })\n  },\n  methods: {\n    iconClassName,\n    getVehicleGroup(){\n      if(this.loginType!=='1') return null;\n      axios.get('common/vehicleGroup', {\n        baseURL,\n        params: {\n          userId:this.$cookies.get('userId'),\n        }\n      }).then(res=> {\n        this.select.vehicleGroup = _.map(res.data, item => {\n          return {value: item.CLZS, label:item.CLZ_NAME}\n        });\n      }).catch(function (error) {\n      });\n    },\n    setChart(data) {\n      let xdata= [],ydata=[];\n      _.map(data,item=>{\n        xdata.push(item.DB_TIME);\n        ydata.push(item.SPEED);\n      });\n      this.chart.el.clear();\n      this.chart.el.setOption({\n        title: {\n          text: '速度曲线报表'\n        },\n        tooltip: {\n          trigger: 'axis'\n        },\n        xAxis: {\n          type: 'category',\n          data: xdata\n        },\n        yAxis: {\n          type: 'value'\n        },\n        series: [\n          {\n            data: ydata,\n            type: 'line',\n            smooth: true\n          }\n        ]\n      })\n    },\n    handleVehicleQuerySearch(query, cb) {\n      if (query.length < 3) return cb([])\n      cb(_.filter(this.select.vehicle, item => item.value.indexOf(query) > -1))\n    },\n    getVehicle(){\n      axios.get('common/vehicle', {\n        baseURL,\n        params: {}\n      }).then(res=> {\n        this.select.vehicle = _.map(res.data, item => {\n          return {\n            value: item.VEHICLE_NO\n          }\n        });\n      }).catch(function (error) {\n      });\n    },\n    findSpeedCurve() {\n      const {startTime, endTime, limit,vehicle,vehicleGroupId} = this.query;\n      if(!vehicle) return this.$message.error(\"请选择车牌号！\")\n      if(!startTime||!endTime) return this.$message.error('请选择时间！');\n      if((startTime&&moment(startTime).format('YYYY-MM'))!==(endTime&&moment(endTime).format('YYYY-MM'))) return this.$message.error('无法跨月查询！');\n      this.table.display = true;\n      axios.get('queryAnalysis/findSpeedCurve', {\n        baseURL,\n        params: {\n          startTime: startTime && moment(startTime).format('YYYY-MM-DD HH:mm:ss'),\n          endTime: endTime && moment(endTime).format('YYYY-MM-DD HH:mm:ss'),\n          limit,\n          vehicle,\n          vehicleGroupId,\n        }\n      }).then(res=> {\n        this.table.data = _.map(res.data, item => {\n          return {\n            VEHICLE_NUM: item.VEHICLE_NUM,\n            STATE: item.STATE,\n            SPEED: item.SPEED,\n            DIRECTION: item.DIRECTION,\n            PX_PY: item.PX+\",\"+item.PY\n          }\n        });\n        this.setChart(res.data||[]);\n        this.table.display = false;\n      }).catch(function (error) {\n      });\n    },\n    /*事件*/\n    handleQueryClick() {\n      this.findSpeedCurve();\n    },\n    handleExportClick() {\n      const {startTime, endTime, limit,vehicle,vehicleGroupId} = this.query;\n      if(!vehicle) return this.$message.error(\"请选择车牌号！\")\n      if(!startTime||!endTime) return this.$message.error('请选择时间！');\n      if((startTime&&moment(startTime).format('YYYY-MM'))!==(endTime&&moment(endTime).format('YYYY-MM'))) return this.$message.error('无法跨月查询！');\n      this.$confirm('是否需要导出?', '提示', {\n        confirmButtonText: '是',\n        cancelButtonText: '否',\n        cancelButtonClass: 'el-button--danger',\n        closeOnClickModal: false,\n        type: 'info',\n        center: true\n      }).then(() => {\n        window.open(`${baseURL}queryAnalysis/findSpeedCurveExcel?startTime=${startTime && moment(startTime).format('YYYY-MM-DD HH:mm:ss')}&endTime=${endTime && moment(endTime).format('YYYY-MM-DD HH:mm:ss')}&limit=${limit}&vehicle=${vehicle}&vehicleGroupId=${vehicleGroupId}`);\n      }).catch(() => {\n\n      });\n    }\n  }\n}\n</script>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SpeedCurveReport.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SpeedCurveReport.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./SpeedCurveReport.vue?vue&type=template&id=61baf01e&\"\nimport script from \"./SpeedCurveReport.vue?vue&type=script&lang=js&\"\nexport * from \"./SpeedCurveReport.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}